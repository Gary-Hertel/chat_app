(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-index-chat"],{"1d4e":function(t,e,n){"use strict";var s;n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return s}));var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"container"},[n("v-uni-view",{staticClass:"whole-box"},[n("v-uni-image",{staticClass:"bg-set",attrs:{src:"https://tse4-mm.cn.bing.net/th/id/OIP-C.4dKL2YlpISczolgxXc4zMAHaN2?w=182&h=341&c=7&r=0&o=5&dpr=2&pid=1.7"}}),n("v-uni-view",{staticClass:"content"},[t._l(t.messages,(function(e,s){return n("v-uni-view",{key:s,staticClass:"cu-chat"},[n("v-uni-view",{staticClass:"content text-center"},[n("v-uni-text",{staticClass:"text-gray"},[t._v(t._s(t.timeList[s]))])],1),n("v-uni-view",{staticClass:"content  text-center"},["join"==e.status?n("v-uni-text",{staticClass:"text-green"},[t._v(t._s(e.username)+"加入了聊天")]):t._e(),"left"==e.status?n("v-uni-text",{staticClass:"text-red"},[t._v(t._s(e.username)+"离开了聊天")]):t._e()],1),"speak"==e.status&&e.username!=t.my_name?n("v-uni-view",{staticClass:"cu-item"},[n("v-uni-view",[n("v-uni-view",{staticClass:"content"},[n("v-uni-image",{staticClass:"cu-avatar radius",attrs:{src:"https://mrocket.cn/static/img/1641990783968_hdImg_9e6b02b56e56a24e78e618ee0d954c7f1639149871161.jpg"}})],1),n("v-uni-text",{staticClass:"text-white text-left"},[t._v(t._s(e.username))])],1),n("v-uni-view",{staticClass:"main"},[n("v-uni-view",{staticClass:"content shadow bg-white"},[n("v-uni-text",[t._v(t._s(e.text))])],1)],1)],1):t._e(),"speak"==e.status&&e.username==t.my_name?n("v-uni-view",{staticClass:"cu-item self"},[n("v-uni-view",{staticClass:"main"},[n("v-uni-view",{staticClass:"content shadow bg-green"},[n("v-uni-text",[t._v(t._s(e.text))])],1)],1),n("v-uni-view",[n("v-uni-view",{staticClass:"content"},[n("v-uni-image",{staticClass:"cu-avatar radius",attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24ely1h0646pnzb9j208c08cdfz.jpg"}})],1),n("v-uni-text",{staticClass:"text-green"},[t._v(t._s(e.username))])],1)],1):t._e()],1)})),n("v-uni-view",{staticClass:"cu-bar foot input",style:[{bottom:t.InputBottom+"px"}]},[n("v-uni-input",{staticClass:"solid-bottom",attrs:{"adjust-position":!1,focus:!1,maxlength:"300","cursor-spacing":"10","confirm-type":"done"},on:{focus:function(e){arguments[0]=e=t.$handleEvent(e),t.InputFocus.apply(void 0,arguments)},blur:function(e){arguments[0]=e=t.$handleEvent(e),t.InputBlur.apply(void 0,arguments)},input:function(e){arguments[0]=e=t.$handleEvent(e),t.onInput.apply(void 0,arguments)},confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.sendMessage(t.my_name,t.my_input,"speak")}},model:{value:t.my_input,callback:function(e){t.my_input=e},expression:"my_input"}}),n("v-uni-button",{staticClass:"cu-btn bg-green shadow",on:{touchend:function(e){e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.sendMessage(t.my_name,t.my_input,"speak")}}},[t._v("发送")])],1)],2)],1)],1)},a=[]},"30be":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s={data:function(){return{InputBottom:0,socketTask:null,is_open_socket:!1,my_name:"",messages:[],my_input:"",room_id:"",timeList:[]}},mounted:function(){var t=document.getElementsByClassName("uni-page-head-hd")[0];t.style.display="none"},onLoad:function(t){this.room_id=t.room_id,this.generate_name()},methods:{getLocalTime:function(){var t=new Date,e=t.toLocaleString();return e},sendJoinMessage:function(){var t=JSON.stringify({username:this.my_name,text:this.username+" join",status:"join"});this.socketTask.send({data:t,success:function(t){console.log("消息发送成功",t)},fail:function(t){console.error("消息发送失败",t)}})},generate_name:function(){var t=this;uni.request({url:"https://chat.mrocket.cn/api/random_name",data:{},header:{},success:function(e){console.log(e.data.data),t.my_name=e.data.data,t.connect_socket(),t.toBottom()}})},onInput:function(t){this.my_input=t.detail.value},InputFocus:function(t){this.InputBottom=t.detail.height},InputBlur:function(t){this.InputBottom=0},connect_socket:function(){var t=this;this.socketTask=uni.connectSocket({url:"wss://chat.mrocket.cn/ws/"+this.room_id,success:function(t){console.log(t)}}),this.socketTask.onOpen((function(e){t.sendJoinMessage(),t.toBottom(),t.socketTask.onMessage((function(e){var n=JSON.parse(e.data);console.log(n),t.timeList.push(t.getLocalTime()),t.messages.push(n),t.toBottom()}))}))},sendMessage:function(t,e,n){if(e){this.my_input=null;var s=JSON.stringify({username:t,text:e,status:n});this.timeList.push(this.getLocalTime()),this.messages.push({username:t,text:e,status:n}),this.toBottom(),this.socketTask.send({data:s,success:function(t){console.log("消息发送成功",t)},fail:function(t){console.error("消息发送失败",t)}})}else uni.showToast({title:"无法发送空的消息",icon:"none"})},closeSocket:function(){this.socketTask.close({success:function(t){this.is_open_socket=!1,console.log("关闭成功",t)},fail:function(t){console.log("关闭失败",t)}})},toBottom:function(){uni.pageScrollTo({scrollTop:999999999999,duration:1,success:function(t){console.log("滑到底部成功",t)},fail:function(t){console.log("滑到底部失败",t)}})}}};e.default=s},"63de":function(t,e,n){"use strict";n.r(e);var s=n("1d4e"),i=n("f7ac");for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);n("d8da");var o,c=n("f0c5"),u=Object(c["a"])(i["default"],s["b"],s["c"],!1,null,"67b2a5f6",null,!1,s["a"],o);e["default"]=u.exports},"8b3e":function(t,e,n){var s=n("24fb");e=s(!1),e.push([t.i,"uni-page-body[data-v-67b2a5f6]{padding-bottom:%?100?%}.bg-set[data-v-67b2a5f6]{position:fixed;width:100%;height:100%;top:0;left:0;z-index:-1}",""]),t.exports=e},b9d7:function(t,e,n){var s=n("8b3e");"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var i=n("4f06").default;i("553bbde4",s,!0,{sourceMap:!1,shadowMode:!1})},d8da:function(t,e,n){"use strict";var s=n("b9d7"),i=n.n(s);i.a},f7ac:function(t,e,n){"use strict";n.r(e);var s=n("30be"),i=n.n(s);for(var a in s)"default"!==a&&function(t){n.d(e,t,(function(){return s[t]}))}(a);e["default"]=i.a}}]);